<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<!-- https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json -->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Bar Chart</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="">
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetch('https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json')
                .then(response => response.json())
                .then(data => {
                    const obj = [...data.data]
                    const gdpAndYearAndDate = []
                    console.log(data)

                    var qAdder = 0
                    obj.forEach(e => {
                        let pairedData = []
                        let rawYear = (parseInt(e[0].substring(0, 4)))
                        let yearAndQ = rawYear + qAdder
                        qAdder += 0.25 // .0 indicates Q1, .25 indicates Q2, ...
                        if (qAdder === 1) {
                            qAdder = 0
                        }

                        pairedData.push(e[1])
                        pairedData.push(yearAndQ)
                        pairedData.push(e[0])

                        gdpAndYearAndDate.push(pairedData)

                    })


                    function getQ(yearQ) {
                        let qIndicator = yearQ % 1
                        switch (qIndicator) {
                            case 0:
                                return 'Q1'
                                break
                            case 0.25:
                                return 'Q2'
                                break
                            case 0.5:
                                return 'Q3'
                                break
                            case 0.75:
                                return 'Q4'
                                break
                            default:
                                break
                        }
                    }

                    console.log(gdpAndYearAndDate)

                    const padding = { top: 20, right: 20, bottom: 40, left: 50 }
                    const barWidthAndMargin = 3
                    const h = 500 + padding.top + padding.bottom
                    const w = obj.length * barWidthAndMargin + padding.left + padding.right

                    const xScale = d3.scaleLinear()
                        .domain([
                            (d3.min(gdpAndYearAndDate, (d) => d[1])),
                            (d3.max(gdpAndYearAndDate, (d) => d[1]))
                        ])
                        .range([padding.left, w - padding.right - 1 * barWidthAndMargin])

                    const yScale = d3.scaleLinear()
                        .domain([0, d3.max(obj, (d) => d[1])])
                        .range([h - padding.bottom, padding.top])

                        const svg = d3.select(".inner")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h)


                    var Tooltip = d3.select(".inner").append("div")
                        .attr("id", "tooltip")
                        .attr("padding", "5px")
                        .attr("border", "solid")
                        .attr("background-color", "white")
                        

                    var mouseover = function (d) {
                        Tooltip
                            .style("opacity", 1)
                        d3.select(this)
                            .style("stroke", "red")
                            .style("opacity", 1)
                    }

                    var mousemove = function (d) {
                        
                        Tooltip
                             .html(`Year${d[0]}`)
                            
                    }

                    var mouseleave = function (d) {
                        Tooltip
                            .style("opacity", 0)
                        d3.select(this)
                            .style("stroke", "none")
                            .style("opacity", 1)
                    }





                    

                    svg.selectAll("rect")
                        .data(gdpAndYearAndDate)
                        .enter()
                        .append("rect")
                        .attr("class", "bar")
                        .attr("width", 1.4)
                        .attr("height", (d) => h - yScale(d[0]) - padding.bottom)
                        .attr("x", (d, i) => i * barWidthAndMargin + padding.left)
                        .attr("y", (d) => yScale(d[0]))
                        .attr("fill", "red")
                        .attr("data-date", (d) => { return `${d[2]}` })
                        .attr("data-gdp", (d) => d[0])
                        .on("mouseover", mouseover)
                        .on("mousemove", (d)=>Tooltip
                             .html(`Year${data-gdp}`))
                        .on("mouseleave", mouseleave)

                    svg.append("rect") //border
                        .attr("x", 0)
                        .attr("y", 0)
                        .attr("height", h)
                        .attr("width", w)
                        .style("stroke", 'black')
                        .style("fill", "none")
                        .style("stroke-width", 1)
                        


                    /* svg.selectAll("text.q") 
                        .data(gdpAndYearAndDate)
                        .enter()
                        .append("text")
                        .text((d) => getQ(d[1]))
                        .attr("x", (d, i) => i * barWidthAndMargin + padding.left)
                        .attr("y", (d) => yScale(d[0]))
                        .attr("font-size", "2px")
                        .attr("class", "q")
 */



                    const xAxis = d3.axisBottom(xScale).tickFormat(d3.format("d"))
                    const yAxis = d3.axisLeft(yScale)

                    svg.append("g")
                        .attr("id", "y-axis")
                        .attr("transform", "translate(" + (padding.left) + ",0)")
                        .call(yAxis)

                    svg.append("g")
                        .attr("id", "x-axis")
                        .attr("transform", "translate(0," + (h - padding.bottom) + ")")
                        .call(xAxis)


                    console.log(obj)


                })



        })
    </script>



    <style>
        body {
            text-align: center;
        }

        .outer {
            display: table;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
        }

        .middle {
            display: table-cell;
            vertical-align: middle;
        }

        .inner {
            margin-left: auto;
            margin-right: auto;
        }
    </style>

    <div class="outer">
        <div class="middle">
            <div class="inner">
                <h1 id="title">Bar Chart</h1>

            </div>
        </div>

    </div>
</body>

</html>